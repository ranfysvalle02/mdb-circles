<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>myCircles</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/ux/icons/icon-256x256.png" />
    <link rel="manifest" href="/ux/manifest.json">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Exo+2:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="/ux/styles.css" />
    <style>
      .custom-popover-color .popover-header {
        color: #0d6efd; /* This is the default Bootstrap primary blue, change as you wish */
        font-weight: bold;
        letter-spacing: 1px;
      }
    </style>
      <style>
        .highlight-pulse {
          animation: pulse-animation 2s infinite;
          box-shadow: 0 0 0 0 rgba(40, 167, 69, 1);
        }

        @keyframes pulse-animation {
          0% {
            box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
          }
          70% {
            box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
          }
          100% {
            box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
          }
        }
        .highlight-wiggle {
        animation: wiggle-animation 2.5s linear infinite;
      }

      @keyframes wiggle-animation {
        0%, 7% { transform: rotateZ(0); }
        15% { transform: rotateZ(-15deg); }
        20% { transform: rotateZ(10deg); }
        25% { transform: rotateZ(-10deg); }
        30% { transform: rotateZ(6deg); }
        35% { transform: rotateZ(-4deg); }
        40%, 100% { transform: rotateZ(0); }
      }
      </style>
  </head>

  <body>
    <div id="particles-js"></div>

    <div class="container">
      <h1
        class="text-center my-4 d-flex align-items-center justify-content-center gap-3"
      >
        <span>myCircles</span>
        <svg
          id="animated-logo-final"
          width="65"
          height="65"
          viewBox="0 0 100 100"
          xmlns="http://www.w3.org/2000/svg"
          style="transform: translateY(-4px);"
        >
          <defs>
            <filter id="glow-filter-final">
              <feGaussianBlur stdDeviation="2" result="coloredBlur"></feGaussianBlur>
              <feMerge>
                <feMergeNode in="coloredBlur"></feMergeNode>
                <feMergeNode in="SourceGraphic"></feMergeNode>
              </feMerge>
            </filter>
          </defs>

          <circle
            cx="50"
            cy="50"
            r="48"
            fill="none"
            stroke="var(--border-color)"
            stroke-width="0.5"
            stroke-dasharray="1 8"
            opacity="0.5"
          >
            <animateTransform
              attributeName="transform"
              type="rotate"
              from="0 50 50"
              to="360 50 50"
              dur="60s"
              repeatCount="indefinite"
            />
          </circle>

          <circle
            cx="50"
            cy="50"
            r="42"
            fill="none"
            stroke="var(--secondary-color)"
            stroke-width="2"
            stroke-dasharray="80 200"
            stroke-linecap="round"
            opacity="0.8"
          >
            <animateTransform
              attributeName="transform"
              type="rotate"
              from="0 50 50"
              to="-360 50 50"
              dur="10s"
              repeatCount="indefinite"
            />
          </circle>

          <circle
            cx="50"
            cy="50"
            r="34"
            fill="none"
            stroke="var(--primary-color)"
            stroke-width="2.5"
            stroke-dasharray="107 107"
            stroke-linecap="round"
            filter="url(#glow-filter-final)"
          >
            <animateTransform
              attributeName="transform"
              type="rotate"
              from="0 50 50"
              to="360 50 50"
              dur="4s"
              repeatCount="indefinite"
            />
          </circle>

          <circle
            cx="50"
            cy="50"
            r="26"
            fill="none"
            stroke="var(--primary-color)"
            stroke-width="2"
            stroke-dasharray="50 150"
            stroke-linecap="round"
          >
            <animateTransform
              attributeName="transform"
              type="rotate"
              from="360 50 50"
              to="0 50 50"
              dur="7s"
              repeatCount="indefinite"
            />
          </circle>

          <circle
            cx="50"
            cy="50"
            r="18"
            fill="none"
            stroke="var(--secondary-color)"
            stroke-width="1"
            stroke-dasharray="20 15"
            opacity="0.7"
          >
            <animateTransform
              attributeName="transform"
              type="rotate"
              from="0 50 50"
              to="-360 50 50"
              dur="3s"
              repeatCount="indefinite"
            />
          </circle>

          <circle cx="50" cy="50" r="5" fill="var(--primary-glow)">
            <animate
              attributeName="r"
              values="5;8;5"
              dur="2.2s"
              repeatCount="indefinite"
              keyTimes="0;0.5;1"
              calcMode="spline"
              keySplines="0.45 0 0.55 1; 0.45 0 0.55 1"
            ></animate>
            <animate
              attributeName="opacity"
              values="1;0.5;1"
              dur="2.2s"
              repeatCount="indefinite"
            ></animate>
          </circle>
        </svg>
      </h1>

      <div id="authSection" class="glass-card text-center hidden">
        

        <div id="authWelcome" class="auth-view">
          <div class="position-relative mb-3">
            <img src="https://www.preventivmeasures.com/wp-content/uploads/2018/05/TheEbbinghausIllusionAnswer.png" alt="The Ebbinghaus Illusion" class="img-fluid rounded"/>
            
            <a tabindex="0" class="position-absolute top-0 end-0 p-2" role="button" 
              data-bs-toggle="popover" 
              data-bs-trigger="hover focus" 
              title="The Ebbinghaus Illusion" 
              data-bs-custom-class="custom-popover-color" 
              data-bs-content="This illusion shows how our perception of size is influenced by surrounding objects. The two central orange circles are exactly the same size, but one appears larger because it's surrounded by smaller circles.">
              <i class="bi bi-info-circle-fill fs-4 text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.7);"></i>
            </a>
          </div>
          <p> In Geometry, a circle is a geometric figure defined by an infinite number of points, all at the same distance from a central point.</p>
          <p>
      Here, each circle is a dedicated space for your friends, family, or team. Share updates, make plans, and build stronger bonds without the noise of traditional social media.
          </p>
          <button id="loginButton" class="btn btn-primary mt-3 px-4 py-2">
            <i class="bi bi-box-arrow-in-right"></i>
            Login / Register
          </button>
        </div>

        <div id="authFormContainer" class="auth-view hidden">
          <h2 class="mb-3">Join the Circle</h2>
          <div>
            <label for="usernameInput" class="form-label">Username</label>
            <input
              type="text"
              class="form-control"
              id="usernameInput"
              placeholder="e.g., alice"
              autocomplete="username"
            />
          </div>
          <div>
            <label for="passwordInput" class="form-label">Password</label>
            <input
              type="password"
              class="form-control"
              id="passwordInput"
              placeholder="e.g., password123"
              autocomplete="current-password"
            />
          </div>
          <div class="auth-actions">
            <button id="backToWelcomeBtn" class="btn btn-secondary">
              <i class="bi bi-arrow-left"></i> Back
            </button>
            <button id="loginSubmitButton" class="btn btn-primary">
              Login
            </button>
            <button id="registerSubmitButton" class="btn btn-success">
              Register
            </button>
          </div>
        </div>
      </div>
      <div id="appSection" class="hidden">
        <div
          id="appHeader"
          class="glass-card d-flex justify-content-between align-items-center mb-4"
        >
          <h2 id="welcomeMessage" class="mb-0 fs-4"></h2>
          <div id="userActions" class="d-flex align-items-center gap-2">
            <button id="createCircleBtn" class="btn btn-success btn-sm">
              <i class="bi bi-plus-circle"></i>
              New Circle
            </button>
            <button id="logoutButton" class="btn btn-danger btn-sm">
              <i class="bi bi-box-arrow-left"></i>
              
            </button>
          </div>
        </div>

        <div id="dashboardView" class="hidden">
          <div class="row">
            <div class="col-12 col-lg-4">
              <div id="sidebar">
                <div class="glass-card">
                  <h3>
                    <i class="bi bi-grid-3x3-gap"></i> myCircles
                  </h3>
                  <p class=" small">
                    Click a circle to view its feed.
                  </p>
                  <div id="myCirclesContainer" class="list-group"></div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-8">
              <div
                class="d-flex justify-content-between align-items-center mb-3 gap-3 flex-wrap"
              >
                <button id="togglePostCreatorBtn" class="btn btn-primary">
                  <i class="bi bi-pencil-square"></i> New Post
                </button>
                <div
                  class="d-flex align-items-center gap-3 flex-wrap justify-content-end flex-grow-1"
                >
                  <div
                    class="input-group input-group-sm"
                    style="width: auto;"
                  >
                    <span
                      class="input-group-text bg-transparent border-end-0"
                      style="border-color: var(--border-color);"
                    >
                      <i class="bi bi-tags"></i>
                    </span>
                    <input
                      type="text"
                      id="dashboardTagFilter"
                      class="form-control border-start-0"
                      placeholder="Filter by tags..."
                      style="min-width: 180px;"
                    />
                  </div>
                  <div class="d-flex align-items-center gap-2">
                    <label
                      for="dashboardSortSelect"
                      class="form-label mb-0 small"
                      >Sort by:</label
                    >
                    <select
                      id="dashboardSortSelect"
                      class="form-select form-select-sm"
                      style="width: auto;"
                    >
                      <option value="newest">Newest</option>
                    </select>
                  </div>
                </div>
              </div>
              <div id="feedContainer" class="feed-timeline"></div>
            </div>
          </div>
        </div>
        <div id="circleView" class="hidden">
          <div id="circleHeader" class="glass-card"></div>
          <div id="circleFeedContainer" class="feed-timeline"></div>
        </div>
        </div>
      <div id="feed-loader" class="hidden">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>

    <div id="globalStatus"></div>
    <div class="modal fade" id="inviteCircleModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Invite to Circle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        
        <div class="mb-4">
          <h6><i class="bi bi-person-plus-fill me-2"></i>Invite a User Directly</h6>
          <p class=" small">Enter the exact username of the person you want to invite.</p>
          <div class="input-group">
            <input type="text" id="directInviteUsernameInput" class="form-control" placeholder="Username...">
            <button class="btn btn-primary" type="button" data-action="send-direct-invite" id="sendDirectInviteBtn">
              Send Invite
            </button>
          </div>
        </div>
        <hr>
        <div class="mt-2">
          <h6><i class="bi bi-link-45deg me-2"></i>Share an Invite Link</h6>
          <p class=" small">Anyone with this link can join for the next 24 hours. A QR code is also provided for easy scanning.</p>
          <div class="input-group mb-3">
            <input type="text" class="form-control" id="inviteLinkInput" readonly>
            <button class="btn btn-secondary" id="copyInviteLinkBtn">Copy</button>
          </div>
          <div id="qrCodeContainer" class="text-center bg-light p-3 rounded">
            </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
    <div
      class="modal fade"
      id="createCircleModal"
      tabindex="-1"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create New Circle</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="createCircleForm">
              <div class="mb-3">
                <label for="circleName" class="visually-hidden"
                  >Circle Name</label
                >
                <input
                  type="text"
                  id="circleName"
                  class="form-control"
                  placeholder="Circle Name"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="circleDescription" class="visually-hidden"
                  >Description (Optional)</label
                >
                <textarea
                  id="circleDescription"
                  class="form-control"
                  placeholder="Description (Optional)"
                ></textarea>
              </div>
              </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              id="submitCircleButton"
              type="button"
              class="btn btn-success"
            >
              <i class="bi bi-check-lg"></i> Create Circle
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="createPostModal"
      tabindex="-1"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <ul
              class="nav nav-tabs card-header-tabs"
              id="postTypeTabs"
            >
              <li class="nav-item">
                <a
                  class="nav-link active"
                  data-bs-toggle="tab"
                  href="#createTextPost"
                  data-post-type="main"
                >
                  <i class="bi bi-chat-left-text-fill"></i>
                  Text
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="tab"
                  href="#createWishlistPost"
                  data-post-type="wishlist"
                >
                  <i class="bi bi-gift-fill"></i>
                  Wishlist
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="tab"
                  href="#createPollPost"
                  data-post-type="poll"
                >
                  <i class="bi bi-ui-checks"></i> Poll
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="tab"
                  href="#createPlaylistPost"
                  data-post-type="playlist"
                >
                  <i class="bi bi-youtube"></i>
                  Playlist
                </a>
              </li>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="tab"
                  href="#createImagePost"
                  data-post-type="image"
                >
                  <i class="bi bi-image"></i> Image
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#createSpotifyPost" data-post-type="spotify_playlist">
                  <i class="bi bi-spotify"></i> Spotify
                </a>
              </li>
            </ul>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="tab-content">
              <div
                class="tab-pane fade show active"
                id="createTextPost"
              >
                <label for="mainPostInput" class="visually-hidden"
                  >Post Content</label
                >
                <textarea
                  id="mainPostInput"
                  class="form-control post-main-input"
                  rows="5"
                  placeholder="What's on your mind?"
                ></textarea>
              </div>
              <div
                class="tab-pane fade"
                id="createWishlistPost"
              >
                <label
                  for="wishlistTitleInput"
                  class="visually-hidden"
                  >Wishlist Title</label
                >
                <input
                  type="text"
                  id="wishlistTitleInput"
                  class="form-control wishlistTitleInput mb-2"
                  placeholder="My Awesome Wishlist âœ¨"
                />
                <div class="input-group mb-3">
                  <label
                    for="wishlistLinkInput"
                    class="visually-hidden"
                    >Wishlist Item URL</label
                  >
                  <input
                    type="url"
                    id="wishlistLinkInput"
                    class="form-control"
                    placeholder="Paste a link to add an item..."
                  />
                  <button
                    class="btn btn-primary"
                    id="addWishlistItemBtn"
                    data-action="add-wishlist-item"
                  >
                    <i class="bi bi-plus-lg"></i> Add
                  </button>
                </div>
                <p class=" small mb-1">Added Items:</p>
                <div
                  id="wishlistStagingArea"
                  class="list-group"
                  style="max-height: 250px; overflow-y: auto;"
                >
                  <div
                    class="list-group-item  small text-center"
                  >
                    Your added items will appear here.
                  </div>
                </div>
              </div>
              <div class="tab-pane fade" id="createPollPost">
                <div
                  class="p-3 rounded mb-3"
                  style="background-color: var(--card-bg-translucent);"
                >
                  <label
                    for="poll-ai-prompt"
                    class="form-label small "
                    >Get a head start with AI:</label
                  >
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control form-control-sm"
                      id="poll-ai-prompt"
                      placeholder="e.g., What movie genre should we watch tonight?"
                    />
                    <button
                      class="btn btn-primary btn-sm"
                      data-action="generate-poll-from-text"
                    >
                      <i class="bi bi-magic"></i> Suggest
                    </button>
                  </div>
                </div>
                <div class="mb-3">
                  <label
                    for="pollQuestionInput"
                    class="form-label"
                    >Poll Question</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="pollQuestionInput"
                    placeholder="What's your question?"
                  />
                </div>
                <div class="mb-2">
                  <label class="form-label"
                    >Options (min 2, max 5)</label
                  >
                  <div id="pollOptionsContainer"></div>
                </div>
                <button
                  class="btn btn-sm btn-outline-success"
                  id="addPollOptionBtn"
                  type="button"
                  data-action="add-poll-option"
                >
                  <i class="bi bi-plus-circle"></i> Add Option
                </button>
                <hr />
                <div>
                  <label
                    for="pollDurationSelect"
                    class="form-label small "
                    >Poll Duration:</label
                  >
                  <select
                    class="form-select form-select-sm"
                    id="pollDurationSelect"
                  >
                    <option value="1">1 Hour</option>
                    <option value="8">8 Hours</option>
                    <option value="24" selected>1 Day</option>
                    <option value="168">7 Days</option>
                  </select>
                </div>
              </div>
              <div class="tab-pane fade" id="createPlaylistPost">
                <label for="playlistNameInput" class="visually-hidden">Playlist Name</label>
                <input
                  type="text"
                  id="playlistNameInput"
                  class="form-control playlistNameInput mb-2"
                  placeholder="My Awesome Playlist ðŸŽµ"
                />

                <div class="input-group mb-3">
                  <input
                    type="url"
                    id="youtubeUrlInput"
                    class="form-control"
                    placeholder="Or paste a YouTube video URL here..."
                  />
                  <button
                    class="btn btn-primary"
                    type="button"
                    data-action="add-yt-video-from-url"
                  >
                    <i class="bi bi-plus-lg"></i> Add
                  </button>
                </div>

                <button
                  class="btn btn-secondary btn-sm mb-2"
                  data-action="open-yt-search"
                >
                  <i class="bi bi-binoculars-fill"></i> Find Videos
                </button>
                <div
                  class="selectedPlaylistVideosContainer mb-2"
                  data-videos="[]"
                >
                  <p class=" small text-center">
                    Added videos will appear here. You can drag to
                    reorder.
                  </p>
                </div>
              </div>
              <div class="tab-pane fade" id="createImagePost">
                <label for="imageFileInput" class="form-label">Upload up to 3 images from your device.</label>
                <input
                  type="file"
                  class="form-control"
                  id="imageFileInput"
                  accept="image/*"
                  multiple
                />
                <div id="imageUploadPreviewContainer" class="mt-3 d-flex flex-wrap gap-2 justify-content-center">
                </div>
                <div class="mt-3">
                  <label for="imageCaptionInput" class="form-label">Optional Caption:</label>
                  <textarea
                    id="imageCaptionInput"
                    class="form-control"
                    rows="2"
                    placeholder="Describe your images..."
                    maxlength="10000"
                  ></textarea>
                </div>
              </div>
              <div class="tab-pane fade" id="createSpotifyPost">
                <label for="spotifyUrlInput" class="form-label">Paste a Spotify Playlist URL</label>
                <input type="url" class="form-control" id="spotifyUrlInput" placeholder="https://open.spotify.com/playlist/...">
                <div class="form-text">
                  Paste a link to a public Spotify playlist. The playlist will be embedded in your post.
                </div>
              </div>
              </div>
          </div>

          <div
            class="modal-footer d-flex justify-content-between"
          >
            <div
              id="modalCreatorFooterLeft"
              class="d-flex align-items-center gap-2 flex-wrap"
            >
              <label
                for="circleSelect"
                class="visually-hidden"
                >Select a Circle</label
              >
              <select
                id="circleSelect"
                class="form-select form-select-sm circleSelect"
                style="width: auto;"
              ></select>

              <label for="postTags" class="visually-hidden"
                >Tags (comma-separated)</label
              >
              <input
                type="text"
                id="postTags"
                class="form-control form-control-sm postTags"
                placeholder="Tags (comma-separated)"
                style="width: auto;"
              />
              <div class="form-check form-switch ms-2">
                <input class="form-check-input" type="checkbox" role="switch" id="enableChatSwitch">
                <label class="form-check-label small" for="enableChatSwitch">Enable Chat</label>
              </div>
              </div>
            <button
              class="btn btn-primary"
              data-action="submit-post"
            >
              <i class="bi bi-rocket-fill"></i>
              Post It
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="playlistPlayerModal"
      tabindex="-1"
    >
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5
              class="modal-title"
              id="playlistPlayerModalLabel"
            >
              Playing Playlist
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-0 d-lg-flex">
            <div class="flex-grow-1 p-3">
              <div
                class="video-container-modal mb-3"
                style="position: relative; padding-bottom: 56.25%; height: 0; background-color: #000; border-radius: 12px; overflow:hidden;"
              >
                <div id="playlist-player-embed"></div>
              </div>
              <div
                class="d-flex justify-content-center align-items-center gap-3"
              >
                <button
                  id="playlist-prev-btn"
                  class="btn btn-primary btn-sm"
                >
                  <i class="bi bi-skip-start-fill"></i>
                </button>
                <span
                  id="playlist-info-span"
                  class=" small"
                  style="min-width: 100px; text-align: center;"
                >
                  Video 1 of X
                </span>
                <button
                  id="playlist-next-btn"
                  class="btn btn-primary btn-sm"
                >
                  <i class="bi bi-skip-end-fill"></i>
                </button>
              </div>
            </div>
            <div
              class="playlist-queue-wrapper border-start-lg"
              style="width: 100%; max-width: 350px; flex-shrink: 0;"
            >
              <h5 class="p-3 mb-0 border-bottom">Up Next</h5>
              <div
                id="playlist-queue-list"
                class="list-group list-group-flush"
                style="max-height: 70vh; overflow-y: auto;"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="youtubeSearchModal"
      tabindex="-1"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-youtube"></i> Find Videos for
              Playlist
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-3">
              <label for="youtubeSearchInput" class="visually-hidden"
                >YouTube Search</label
              >
              <input
                type="text"
                id="youtubeSearchInput"
                class="form-control"
                placeholder="Search YouTube..."
              />
              <button
                id="youtubeSearchBtn"
                class="btn btn-primary"
              >
                <i class="bi bi-search"></i> Search
              </button>
            </div>
            <div id="youtubeSearchResultsContainer">
              <p class=" small text-center">
                Search results will appear here.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="manageCircleModal"
      tabindex="-1"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <ul
              class="nav nav-tabs card-header-tabs"
              id="manageCircleTabs"
            >
              <li class="nav-item">
                <a
                  class="nav-link active"
                  data-bs-toggle="tab"
                  href="#manageSettingsTab"
                >
                  <i class="bi bi-gear-wide-connected"></i>
                  Settings
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="tab"
                  href="#manageMembersTab"
                >
                  <i class="bi bi-people-fill"></i> Members
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  data-bs-toggle="tab"
                  href="#manageDangerZoneTab"
                >
                  <i class="bi bi-exclamation-triangle-fill"></i>
                  Danger Zone
                </a>
              </li>
            </ul>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <div class="modal-body">
            <div class="tab-content">
              <div
                class="tab-pane fade show active"
                id="manageSettingsTab"
              >
                <form id="manageCircleSettingsForm">
                  <input
                    type="hidden"
                    id="manageCircleId"
                  />
                  <div class="mb-3">
                    <label
                      for="manageCircleName"
                      class="form-label"
                      >Circle Name</label
                    >
                    <input
                      type="text"
                      id="manageCircleName"
                      class="form-control"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label
                      for="manageCircleDescription"
                      class="form-label"
                      >Description</label
                    >
                    <textarea
                      id="manageCircleDescription"
                      class="form-control"
                    ></textarea>
                  </div>

                  <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" role="switch" id="manageCircleIsPublic">
                    <label class="form-check-label" for="manageCircleIsPublic">Make Circle Public</label>
                    <small class="form-text d-block">Public circles and their posts can be viewed by anyone, even if they are not logged in.</small>
                  </div>
                  </form>
              </div>
              <div class="tab-pane fade" id="manageMembersTab">
                <h5>Member List</h5>
                <p class=" small">
                  Manage roles and access for circle members.
                </p>
                <div
                  id="manageCircleMembersContainer"
                  class="list-group list-group-flush"
                  style="max-height: 400px; overflow-y: auto;"
                ></div>
              </div>
              <div
                class="tab-pane fade"
                id="manageDangerZoneTab"
              >
                <div class="alert alert-danger">
                  <h4 class="alert-heading">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    Warning!
                  </h4>
                  <p>
                    The action below is irreversible.
                    Deleting the circle will remove all its
                    posts, members, and data permanently.
                  </p>
                </div>
                <h5 class="mt-4">Delete this Circle</h5>
                <p>
                  To confirm, please type the name of the
                  circle (<strong
                    id="confirmDeleteCircleName"
                  ></strong
                  >) in the box below.
                </p>
                <div class="input-group mb-3">
                  <label
                    for="deleteCircleConfirmationInput"
                    class="visually-hidden"
                    >Confirm Circle Name</label
                  >
                  <input
                    type="text"
                    id="deleteCircleConfirmationInput"
                    class="form-control"
                    placeholder="Type circle name to confirm..."
                  />
                  <button
                    id="deleteCircleBtn"
                    class="btn btn-danger"
                    disabled
                  >
                    <i class="bi bi-trash-fill"></i> Delete
                    Permanently
                  </button>
                </div>
              </div>
              </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              id="saveCircleSettingsBtn"
              type="button"
              class="btn btn-primary"
            >
              <i class="bi bi-save-fill"></i> Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="seenStatusModal"
      tabindex="-1"
    >
      <div
        class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
      >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-eye-fill"></i> Post View Status
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div>
              <h5 class="mb-3">
                <i class="bi bi-check-circle-fill text-success"></i>
                Seen By
              </h5>
              <ul
                id="seenUserList"
                class="list-group list-group-flush"
              ></ul>
            </div>
            <hr />
            <div>
              <h5 class="mb-3">
                <i class="bi bi-circle "></i> Not
                Yet Seen
              </h5>
              <ul
                id="unseenUserList"
                class="list-group list-group-flush"
              ></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="commentsModal"
      tabindex="-1"
    >
      <div
        class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
      >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-chat-left-text-fill"></i>
              Comments
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body d-flex flex-column">
            <div id="originalPostContainer" class="mb-3"></div>
            <div id="commentsContainer" class="flex-grow-1"></div>
          </div>
          <div class="modal-footer">
            <form id="commentForm" class="w-100">
              <div class="input-group">
                <label for="commentInput" class="visually-hidden"
                  >Write a comment</label
                >
                <textarea
                  id="commentInput"
                  class="form-control"
                  placeholder="Write a comment..."
                  rows="1"
                  required
                ></textarea>
                <button class="btn btn-primary" type="submit">
                  <i class="bi bi-send"></i>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-modal="true" role="dialog">
      <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="helpModalLabel"><i class="bi bi-shield-check"></i> Why Circles? A Quick Guide</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="lead">Welcome to myCircles! We believe social media is broken. Instead of one giant feed, we need spaces built for the real, distinct relationships in our lives. This guide explains how it works.</p>

            <div class="accordion" id="helpAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    <strong>From a Single Feed to Many Circles</strong>
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#helpAccordion">
                  <div class="accordion-body">
                    Online, we often perform a generic version of ourselves, which is exhausting. This is called "context collapse." myCircles fixes this.<br><br>
                    A <strong>Circle</strong> is your private, dedicated space for a specific groupâ€”your family, your vacation crew, your dev team. Instead of broadcasting to the world, you <strong>share with precision</strong>. This kills the social anxiety of oversharing or being irrelevant to the wrong people. Itâ€™s a move from broadcasting to <strong>belonging</strong>.<br><br>
                    Create a new circle with the <button class="btn btn-success btn-sm disabled"><i class="bi bi-plus-circle"></i> New Circle</button> button. To invite others, go into a circle and click the <button class="btn btn-success btn-sm disabled"><i class="bi bi-send"></i> Invite</button> button.
                  </div>
                </div>
              </div>

              <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    <strong>Your Communities, Your Views</strong>
                  </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#helpAccordion">
                  <div class="accordion-body">
                    <ul>
                      <li>The <strong>Dashboard</strong> brings all your communities together in one place. It shows a combined feed of recent posts from <em>all</em> the circles you're in. You can filter this global feed using the "My Circles" list on the left.</li>
                      <li>The <strong>Circle View</strong> is your focused space. Click on a specific circle name to see <em>only</em> posts from that group. Here, you can also find tools to invite new members or manage the circle's settings (if you have permission).</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    <strong>Share Your Authentic Self</strong>
                  </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#helpAccordion">
                  <div class="accordion-body">
                    When you know exactly who you're talking to, you can share more freely. Click the <button class="btn btn-primary btn-sm disabled"><i class="bi bi-pencil-square"></i> New Post</button> button to open the post creator, where you can choose the perfect format for your audience:
                    <ul>
                      <li><i class="bi bi-chat-left-text-fill"></i> <strong>Text:</strong> A standard text post. You can also paste links which may automatically embed.</li>
                      <li><i class="bi bi-gift-fill"></i> <strong>Wishlist:</strong> Create a list of links to products or gifts for a specific occasion.</li>
                      <li><i class="bi bi-ui-checks"></i> <strong>Poll:</strong> Ask a question with multiple choice options. You can even use the AI assistant to help generate ideas!</li>
                      <li><i class="bi bi-music-note-list"></i> <strong>Playlist:</strong> Search YouTube and build a collaborative video playlist to share.</li>
                      <li><i class="bi bi-image"></i> <strong>Image:</strong> Upload an image from your device or paste a URL to an image.</li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingFour">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                    <strong>Meaningful Interactions</strong>
                  </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#helpAccordion">
                  <div class="accordion-body">
                    <ul>
                      <li><strong>Seen Status:</strong> Know who's up to date. As you scroll, posts are marked as "seen." Click the text like "Seen by 2 others" to see a full list of who has and hasn't viewed a post yet. This is great for making sure everyone saw the plan for Friday night!</li>
                      <li><strong>Comments:</strong> Conversations are private between the post author and each individual commenter, keeping discussions focused and personal. Click the <i class="bi bi-chat-left-text"></i> icon to open the comments view.</li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingFive">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                    <strong><i class="bi bi-phone"></i> Get the App Experience</strong>
                  </button>
                </h2>
                <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#helpAccordion">
                  <div class="accordion-body">
                    For the best experience, install myCircles on your device. It's faster, uses less data, and gives you one-tap access from your home screen.
                    <br><br>
                    <a href="/ux/install.html" class="btn btn-primary"><i class="bi bi-download"></i> View Installation Instructions</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Got It!</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="chatParticipantSelectorModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Select Chat Members</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p class="small">Choose which circle members to include in this post's private group chat. You will be included automatically.</p>
            <div id="chatParticipantList" style="max-height: 40vh; overflow-y: auto;"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" data-action="confirm-chat-participants">Confirm</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade" id="chatModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="chatModalTitle"><i class="bi bi-chat-dots-fill"></i> Group Chat</h5>
            <div id="chatModalHeaderActions"></div>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="chatMessagesContainer">
            </div>
          <div class="modal-footer">
            <form id="chatForm" class="w-100">
              <div class="input-group">
                <textarea id="chatInput" class="form-control" placeholder="Type a message..." rows="1" required></textarea>
                <button class="btn btn-primary" type="submit"><i class="bi bi-send-fill"></i></button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="editPostModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title"><i class="bi bi-pencil-square"></i> Edit Post</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form id="editPostForm">
                <input type="hidden" id="editPostId">
                <input type="hidden" id="editCircleId">
                
                <div id="editPostContentContainer" class="mb-3"></div>
                
                <div id="editPostTextContainer" class="mb-3">
                  <label for="editPostText" class="form-label">Post Text</label>
                  <textarea id="editPostText" class="form-control" rows="5"></textarea>
                </div>
                <div id="editPostTagsContainer" class="mb-3">
                  <label for="editPostTags" class="form-label">Tags (comma-separated)</label>
                  <input type="text" id="editPostTags" class="form-control">
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="editEnableChatSwitch">
                  <label class="form-check-label" for="editEnableChatSwitch">Enable Chat</label>
                </div>
                <div id="editChatOptionsContainer" class="mt-2 hidden">
                  <button type="button" class="btn btn-sm btn-outline-primary" data-action="edit-chat-participants">
                    <i class="bi bi-people-fill"></i> Manage Participants
                  </button>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" data-action="save-post-edits">Save Changes</button>
            </div>
          </div>
        </div>
      </div>
    

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"
    ></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <script src="/ux/app.js"></script>
    
    <script>
      // This script initializes the popover on the login page
      document.addEventListener('DOMContentLoaded', function () {
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
        [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl));
      });
    </script>
    
    <button
      id="helpButton"
      class="btn btn-primary rounded-circle"
      style="position: fixed; bottom: 20px; right: 20px; z-index: 1050; width: 50px; height: 50px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);"
      data-bs-toggle="modal"
      data-bs-target="#helpModal"
      title="Get Help"
    >
      <i class="bi bi-question-lg fs-4"></i>
    </button>

    <footer class="container text-center  small py-4">
      <p>Â© 2025 myCircles by OBLIVIO LLC</p>
      <a href="/ux/privacy.html" class="text-decoration-none">Privacy Policy</a> Â· 
      <a href="/ux/terms.html" class="text-decoration-none">Terms of Service</a>
    </footer>
  </body>
</html>